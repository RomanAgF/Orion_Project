let data = {
  firstGroupQuest: [
    {
      id: "1439",
      question: "От какого дерева появляются желуди?",
      answer: {
        a: { text: "Каштан", accept: "false" },
        b: { text: "Ясень", accept: "false" },
        c: { text: "Дуб", accept: "true" },
        d: { text: "Клен", accept: "false" },
      },
    },
    {
      id: "9894",
      question: "Что не является кисломолочным продуктом?",
      answer: {
        a: { text: "Сыр", accept: "false" },
        b: { text: "Майонез", accept: "true" },
        c: { text: "Сметана", accept: "false" },
        d: { text: "Творог", accept: "false" },
      },
    },
    {
      id: "9985",
      question: "Какому коню в зубы не смотрят?",
      answer: {
        a: { text: "Жареному", accept: "false" },
        b: { text: "Горем убитому", accept: "false" },
        c: { text: "С кариесом", accept: "false" },
        d: { text: "Дарёному", accept: "true" },
      },
    },
    {
      id: "9363",
      question: "Из какого злака получают манную крупу?",
      answer: {
        a: { text: "Пшеница", accept: "true" },
        b: { text: "Рожь", accept: "false" },
        c: { text: "Ячмень", accept: "false" },
        d: { text: "Просо", accept: "false" },
      },
    },
    {
      id: "6905",
      question: "Кого иногда называют спрутом?",
      answer: {
        a: { text: "Кашалота", accept: "false" },
        b: { text: "Медузу", accept: "false" },
        c: { text: "Каракатицу", accept: "false" },
        d: { text: "Осьминога", accept: "true" },
      },
    },
    {
      id: "5778",
      question: "Какая сельскохозяйственная культура сама удобряет почву?",
      answer: {
        a: { text: "Свекла", accept: "false" },
        b: { text: "Горох", accept: "true" },
        c: { text: "Рожь", accept: "false" },
        d: { text: "Кукуруза", accept: "false" },
      },
    },
    {
      id: "3191",
      question: "Что человек может сделать для гибискуса?",
      answer: {
        a: { text: "Вычистить клетку", accept: "false" },
        b: { text: "Расчесать шерсть", accept: "false" },
        c: { text: "Поменять воду в аквариуме", accept: "false" },
        d: { text: "Полить", accept: "true" },
      },
    },
    {
      id: "9601",
      question: "За какое время периода Земля оборачивается вокруг Солнца?",
      answer: {
        a: { text: "За месяц", accept: "false" },
        b: { text: "За неделю", accept: "false" },
        c: { text: "За год", accept: "true" },
        d: { text: "За сутки", accept: "false" },
      },
    },
    {
      id: "8776",
      question: "Какая мышца в теле человека самая крупная?",
      answer: {
        a: { text: "Грудная", accept: "false" },
        b: { text: "Ягодичная", accept: "true" },
        c: { text: "Икроножная", accept: "false" },
        d: { text: "Дельтовидная", accept: "false" },
      },
    },
    {
      id: "5237",
      question:
        "Какой химический элемент был впервые получен из морских водорослей?",
      answer: {
        a: { text: "Фософр", accept: "false" },
        b: { text: "Сера", accept: "false" },
        c: { text: "Йод", accept: "true" },
        d: { text: "Калий", accept: "false" },
      },
    },
    {
      id: "4234",
      question: "В какую из игр играют не клюшкой?",
      answer: {
        a: { text: "Бильярд", accept: "true" },
        b: { text: "Поло", accept: "false" },
        c: { text: "Хоккей", accept: "false" },
        d: { text: "Гольф", accept: "false" },
      },
    },
    {
      id: "7087",
      question: "С какой из этих стран Чехия не граничит?",
      answer: {
        a: { text: "Германия", accept: "false" },
        b: { text: "Австрия", accept: "false" },
        c: { text: "Польша", accept: "false" },
        d: { text: "Венгрия", accept: "true" },
      },
    },
    {
      id: "2358",
      question:
        "Какое брюхо, согласно спорной русской пословице, глухо к ученью?",
      answer: {
        a: { text: "Толстое", accept: "false" },
        b: { text: "Тощее", accept: "false" },
        c: { text: "Сытое", accept: "true" },
        d: { text: "Пустое", accept: "false" },
      },
    },
    {
      id: "8035",
      question: "Кто считается основоположником кубизма?",
      answer: {
        a: { text: "П. Пикассо", accept: "true" },
        b: { text: "В. Кадинский", accept: "false" },
        c: { text: "А. Энштейн", accept: "false" },
        d: { text: "К. Малевич", accept: "false" },
      },
    },
    {
      id: "2556",
      question: "Территория какой из этих стран - наибольшая?",
      answer: {
        a: { text: "Германия", accept: "false" },
        b: { text: "Япония", accept: "true" },
        c: { text: "Италия", accept: "false" },
        d: { text: "Финляндия", accept: "false" },
      },
    },
  ],
  secondGroupQuest: [
    {
      id: "3983",
      question: "Какая рыба, чтобы освободиться от крючка, часто делает свечу?",
      answer: {
        a: { text: "Осетр", accept: "false" },
        b: { text: "Щука", accept: "true" },
        c: { text: "Налим", accept: "false" },
        d: { text: "Карась", accept: "false" },
      },
    },
    {
      id: "8452",
      question: "Назовите природную среду обитания страуса эму",
      answer: {
        a: { text: "Африка", accept: "false" },
        b: { text: "Австралия", accept: "true" },
        c: { text: "Южная Америка", accept: "false" },
        d: { text: "Индонезия", accept: "false" },
      },
    },
    {
      id: "7616",
      question: "Что коллекционирует фалерист?",
      answer: {
        a: { text: "Марки", accept: "false" },
        b: { text: "Значки", accept: "true" },
        c: { text: "Открытки", accept: "false" },
        d: { text: "Конверты", accept: "false" },
      },
    },
    {
      id: "2009",
      question: "Территория какой из этих стран - наибольшая?",
      answer: {
        a: { text: "Япония", accept: "true" },
        b: { text: "Германия", accept: "false" },
        c: { text: "Италия", accept: "false" },
        d: { text: "Финляндия", accept: "false" },
      },
    },
    {
      id: "1897",
      question: "Как по-научному называется питьевой спирт?",
      answer: {
        a: { text: "Метанол", accept: "false" },
        b: { text: "Политура", accept: "false" },
        c: { text: "Этанол", accept: "true" },
        d: { text: "Микстура", accept: "false" },
      },
    },
    {
      id: "6571",
      question: "Что у моряков называется камбузом?",
      answer: {
        a: { text: "Кладовая", accept: "false" },
        b: { text: "Кухная", accept: "true" },
        c: { text: "Машинное отделение", accept: "false" },
        d: { text: "Мостик капитана", accept: "false" },
      },
    },
    {
      id: "6895",
      question: "В какой стране зародилась игра кегли?",
      answer: {
        a: { text: "Швейцария", accept: "false" },
        b: { text: "Голландия", accept: "false" },
        c: { text: "Австрия", accept: "false" },
        d: { text: "Германия", accept: "true" },
      },
    },
    {
      id: "8370",
      question:
        "Какое вино необходимо для приготовления классического крюшона?",
      answer: {
        a: { text: "Мадера", accept: "false" },
        b: { text: "Белое столовое", accept: "true" },
        c: { text: "Портвейн", accept: "false" },
        d: { text: "Красное столовое", accept: "false" },
      },
    },
    {
      id: "4491",
      question: "Кто такой речной сверчок?",
      answer: {
        a: { text: "Рыба", accept: "false" },
        b: { text: "Насекомое", accept: "false" },
        c: { text: "Рептилия", accept: "false" },
        d: { text: "Птица", accept: "true" },
      },
    },
    {
      id: "2244",
      question: "Какое из этих австралийских животных не имеет сумки?",
      answer: {
        a: { text: "Утконос", accept: "true" },
        b: { text: "Коала", accept: "false" },
        c: { text: "Вомбат", accept: "false" },
        d: { text: "Ехидна", accept: "false" },
      },
    },
    {
      id: "8840",
      question: "Какого цвета ягоды ядовитого плюща?",
      answer: {
        a: { text: "Синие", accept: "false" },
        b: { text: "Красные", accept: "false" },
        c: { text: "Белые", accept: "true" },
        d: { text: "Черные", accept: "false" },
      },
    },
    {
      id: "1953",
      question: "Какая из этих рек впадает в Азовское море?",
      answer: {
        a: { text: "Дон", accept: "true" },
        b: { text: "Днестр", accept: "false" },
        c: { text: "Днепр", accept: "false" },
        d: { text: "Южный Буг", accept: "false" },
      },
    },
    {
      id: "7634",
      question:
        "Одним из направлений какой религиозной философии является учение дзен?",
      answer: {
        a: { text: "Даосизм", accept: "false" },
        b: { text: "Буддизм", accept: "true" },
        c: { text: "Иудаизм", accept: "false" },
        d: { text: "Пастафарианство", accept: "false" },
      },
    },
    {
      id: "3709",
      question:
        "Какой химический элемент был назван в честь злого подземного гнома?",
      answer: {
        a: { text: "Теллур", accept: "false" },
        b: { text: "Бериллий", accept: "false" },
        c: { text: "Кобальт", accept: "true" },
        d: { text: "Гафний", accept: "false" },
      },
    },
    {
      id: "8338",
      question: "Как в народе называют химическое соединение - тринитротолуол?",
      answer: {
        a: { text: "Пластид", accept: "false" },
        b: { text: "Динамит", accept: "false" },
        c: { text: "Гексаген", accept: "false" },
        d: { text: "Тротил", accept: "true" },
      },
    },
    {
      id: "2015",
      question: "У кого из вампиров кровь пьют только самки?",
      answer: {
        a: { text: "Комары", accept: "true" },
        b: { text: "Летучие мыши", accept: "false" },
        c: { text: "Оборотни", accept: "false" },
        d: { text: "Клещи", accept: "false" },
      },
    },
  ],
  thirdGroupQuest: [
    {
      id: "9882",
      question: "Что изучает семиотика?",
      answer: {
        a: { text: "Человекообразных обезьян", accept: "false" },
        b: { text: "Знаки и символы", accept: "true" },
        c: { text: "Происхождение слов", accept: "false" },
        d: { text: "Флаги", accept: "false" },
      },
    },
    {
      id: "7446",
      question: "В каком из этих алфавитов меньше всего букв?",
      answer: {
        a: { text: "Латинский", accept: "false" },
        b: { text: "Грузинский", accept: "false" },
        c: { text: "Армянский", accept: "false" },
        d: { text: "Греческий", accept: "true" },
      },
    },
    {
      id: "2261",
      question: "Из какого языка пришло слово алгебра?",
      answer: {
        a: { text: "Греческого", accept: "false" },
        b: { text: "Санскрипта", accept: "false" },
        c: { text: "Арабского", accept: "true" },
        d: { text: "Иврита", accept: "false" },
      },
    },
    {
      id: "4285",
      question: "Вождём какого племени был Монтесума?",
      answer: {
        a: { text: "Ацтеки", accept: "true" },
        b: { text: "Майа", accept: "false" },
        c: { text: "Инки", accept: "false" },
        d: { text: "Ирокезы", accept: "false" },
      },
    },
    {
      id: "8224",
      question: "Чему равен один британский фут?",
      answer: {
        a: { text: "30.50 см", accept: "false" },
        b: { text: "30.52 см", accept: "false" },
        c: { text: "30.48 см", accept: "true" },
        d: { text: "30.43 см", accept: "false" },
      },
    },
    {
      id: "3417",
      question: "Что греки называли водяным вором - клепсидрой?",
      answer: {
        a: { text: "Водную мельницу", accept: "false" },
        b: { text: "Баню", accept: "false" },
        c: { text: "Акведук", accept: "false" },
        d: { text: "Водяные часы", accept: "true" },
      },
    },
    {
      id: "3390",
      question: "Какую реку древние греки называли Танаис?",
      answer: {
        a: { text: "Дон", accept: "true" },
        b: { text: "Днестр", accept: "false" },
        c: { text: "Дунай", accept: "false" },
        d: { text: "Днепр", accept: "false" },
      },
    },
    {
      id: "1727",
      question: "Какой из этих народов населяет территорию Шри-Ланки?",
      answer: {
        a: { text: "Невары", accept: "false" },
        b: { text: "Бхотия", accept: "false" },
        c: { text: "Ведды", accept: "true" },
        d: { text: "Мяо", accept: "false" },
      },
    },
    {
      id: "2378",
      question: "Какого города нет в Казахстане?",
      answer: {
        a: { text: "Самарканд", accept: "true" },
        b: { text: "Шымкент", accept: "false" },
        c: { text: "Караганда", accept: "false" },
        d: { text: "Павлодар", accept: "false" },
      },
    },
    {
      id: "4780",
      question: "Кем по образованию был Антон Павлович Чехов?",
      answer: {
        a: { text: "Программист", accept: "false" },
        b: { text: "Врач", accept: "true" },
        c: { text: "Историк", accept: "false" },
        d: { text: "Учитель", accept: "false" },
      },
    },
    {
      id: "3605",
      question:
        "Как называл народ медную монету в 3 копейки после 40 годов XIX века?",
      answer: {
        a: { text: "Рубль", accept: "false" },
        b: { text: "Грош", accept: "false" },
        c: { text: "Гривенный", accept: "true" },
        d: { text: "Гривна", accept: "false" },
      },
    },
    {
      id: "5800",
      question:
        "На борту какого линкора ВМФ США был подписан акт о капитуляции Японии во второй мировой войне?",
      answer: {
        a: { text: "Нью-Джерси", accept: "false" },
        b: { text: "Айова", accept: "false" },
        c: { text: "Миссури", accept: "true" },
        d: { text: "Висконсин", accept: "false" },
      },
    },
    {
      id: "2920",
      question: "Какой европейский город раньше носил название Лютеция?",
      answer: {
        a: { text: "Лондон", accept: "false" },
        b: { text: "Париж", accept: "true" },
        c: { text: "Тулуза", accept: "false" },
        d: { text: "Воронеж", accept: "false" },
      },
    },
    {
      id: "2905",
      question: "Как назывался первый атомный ледокол СССР?",
      answer: {
        a: { text: "Ленин", accept: "true" },
        b: { text: "Сталин", accept: "false" },
        c: { text: "Киров", accept: "false" },
        d: { text: "Порошенко", accept: "false" },
      },
    },
    {
      id: "6111",
      question:
        "Под каким названием всему миру была известна разведслужба бывшей ГДР?",
      answer: {
        a: { text: "СБУ", accept: "false" },
        b: { text: "МОССАД", accept: "false" },
        c: { text: "АНБ", accept: "false" },
        d: { text: "ШТАЗИ", accept: "true" },
      },
    },
  ],
};

(function () {
  let modal = document.querySelector(".modal-overlay"),
    preloader = document.querySelector(".banter-loader"),
    counterWrap = document.querySelector(".millionaire-timer"),
    counterText = document.querySelector(".millionaire-timer__text"),
    nickNameModal = document.querySelector(".modal-window-welcome"),
    nickNameBtn = document.querySelector(".modal__button"),
    nickNameInput = document.querySelector(".modal__input"),
    progressList = document.querySelector(".millionaire-progress-list"),
    question = document.querySelector(".millionaire-ui__question-text"),
    answers = document.querySelector(".millionaire-ui-answers");

  let hints = document.querySelectorAll(
      ".millionaire-hints__hint:not(.millionaire-hints__hint_disabled)"
    ),
    half = document.querySelector(
      ".millionaire-hints__hint-half:not(.millionaire-hints__hint_disabled)"
    ),
    double = document.querySelector(
      ".millionaire-hints__hint-double:not(.millionaire-hints__hint_disabled)"
    ),
    protect = document.querySelector(
      ".millionaire-hints__hint-protect:not(.millionaire-hints__hint_disabled)"
    );

  var gameOptions,
    progress = [
      100, 200, 300, 500, 1000, 2000, 4000, 8000, 16000, 32000, 64000, 125000,
      250000, 500000, 1000000,
    ];
  // убрать прелоадер по загрузке
  window.addEventListener("load", function () {
    modal.classList.remove("modal-overlay_fill-bg");
    preloader.classList.add("banter-loader_hidden");
    setTimeout(function () {
      nickNameModal.classList.add("modal-window_show");
    }, 800);
  });

  // обработка ввода имени
  nickNameBtn.addEventListener("click", function () {
    if (nickNameInput.value) {
      modal.classList.add("modal-overlay_hidden");
      nickNameModal.classList.remove("modal-window_show");
      // инициализация объекта настроек
      gameOptions = new Game();
      gameOptions.startRound();
    } else {
      nickNameInput.classList.add("modal__input_error");
    }
  });

  // ввод после попытки начать без имени
  nickNameInput.addEventListener("keypress", checkNickName);
  nickNameInput.addEventListener("keydown", checkNickName);
  nickNameInput.addEventListener("keyup", checkNickName);
  nickNameInput.addEventListener("change", checkNickName);

  function splitIt(number, separator) {
    number += "";
    separator = separator == undefined ? " " : separator;

    var result = "",
      arr = [];

    for (var i = 0; i < number.length; i++) {
      arr.push(number[i]);

      if ((i - number.length) % 3 == 0 && i != 0) {
        arr[i] = separator + arr[i];
      }

      result += arr[i];
    }

    return result;
  }

  function checkNickName() {
    if (nickNameInput.value)
      nickNameInput.classList.remove("modal__input_error");
  }

  function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min)) + min;
  }

  function showModal(selector) {
    // body...
  }

  function hideModal(selector) {
    // body...
  }

  function Game() {
    var that = this;

    this.nickName = nickNameInput.value;
    this.timer = 30;
    this.step = 0;
    this.complexity;

    this.stepInc = function () {
      that.step++;

      switch (that.step) {
        case 5:
          that.bank = progress[4];
          progressList.children[4].classList.add(
            "millionaire-progress-list__item_block"
          );
          break;
        case 10:
          that.bank = progress[9];
          break;
        case 15:
          that.bank = progress[14];
          break;
        default:
          that.bank = 0;
      }

      function lockBank(index) {
        Array.from(progressList.children).forEach(function (el) {
          el.classList.remove("millionaire-progress-list__item_block");
        });
        progressList.children[index].classList.add(
          "millionaire-progress-list__item_block"
        );
      }
    };

    this.setStep = function () {
      progressList.children[that.step].classList.add(
        "millionaire-progress-list__item_active"
      );

      if (progressList.children[that.step - 1]) {
        progressList.children[that.step - 1].classList.remove(
          "millionaire-progress-list__item_active"
        );
        progressList.children[that.step - 1].classList.add(
          "millionaire-progress-list__item_complete"
        );
      }
    };

    this.getQuestions = function () {
      if (that.step < 5) that.complexity = "firstGroupQuest";
      if (that.step >= 5) that.complexity = "secondGroupQuest";
      if (that.step >= 10) that.complexity = "thirdGroupQuest";

      that.questions = data[that.complexity];
    };

    this.getQuestion = function () {
      that.currentRound = that.questions.splice(
        getRandomInt(0, that.questions.length),
        1
      )[0];
    };

    this.setQuestion = function () {
      question.innerText = that.currentRound.question;

      while (answers.children.length) answers.firstElementChild.remove();

      for (let key in that.currentRound.answer) {
        let item = document.createElement("div");
        item.classList.add("millionaire-ui-answers__item", "ui");
        item.innerText = that.currentRound.answer[key].text;
        item.setAttribute("data-id", `${that.currentRound.id}${key}`);
        answers.appendChild(item);
      }
    };

    this.startRound = function () {
      that.timerStart();

      answers.classList.remove("millionaire-ui-answers_picked");

      that.getQuestions();
      that.getQuestion();
      that.setQuestion();

      console.log(gameOptions.currentRound.answer);
    };

    this.timerStart = function () {
      let counter = that.timer;

      document.querySelector(".millionaire-timer__bg").remove();

      let item = document.createElement("div");
      item.classList.add(
        "millionaire-timer__bg_started",
        "millionaire-timer__bg"
      );
      item.style.animationDuration = `${that.timer}s`;
      item.style.animationDelay = `1s`;
      counterWrap.appendChild(item);

      counterText.innerText = counter;
      that.timeout = setTimeout(function countDec() {
        counter--;
        counterText.innerText = counter;
        if (counter) {
          that.timeout = setTimeout(countDec, 1000);
        } else {
          that.endGame();
        }
      }, 1000);
    };

    this.timerStop = function () {
      clearTimeout(that.timeout);
      document
        .querySelector(".millionaire-timer__bg")
        .classList.add("millionaire-timer__bg_paused");
    };

    this.getChoise = function (el) {
      el.classList.add("millionaire-ui-answers__item_picked");
      answers.classList.add("millionaire-ui-answers_picked");
      that.timerStop();

      var id = el.getAttribute("data-id").slice(-1),
        correct = that.currentRound.answer[id].accept == "true";

      if (correct) setTimeout(that.accept, 1000, el);
      else {
        setTimeout(
          function () {
            that.fail(el);
            that.showCorrect(el);
          },
          1000,
          el
        );
      }
    };

    this.accept = function (item) {
      item.classList.add("millionaire-ui-answers__item_accept");
      that.stepInc();
      setTimeout(function () {
        that.setStep();
        that.startRound();
      }, 2000);
    };

    this.fail = function (item) {
      item.classList.add("millionaire-ui-answers__item_fail");
    };

    this.showCorrect = function (item) {
      for (let key in that.currentRound.answer) {
        if (that.currentRound.answer[key].accept == "true") {
          document
            .querySelector(`[data-id="${that.currentRound.id}${key}"]`)
            .classList.add("millionaire-ui-answers__item_accept");
          break;
        } else continue;
      }
    };

    this.endGame = function () {
      // body...
    };

    this.hint = {
      half: function () {
        let roll = [];

        for (let key in that.currentRound.answer) {
          if (that.currentRound.answer[key].accept == "false") roll.push(key);
        }

        roll.splice(getRandomInt(0, roll.length), 1);

        roll.forEach(function (el) {
          let item = document.querySelector(
            `[data-id="${that.currentRound.id}${el}"]`
          );
          item.classList.add("millionaire-ui-answers__item_lock");
        });
      },
    };

    // отключать подсказку при клике
    for (let i = 0; i < hints.length; i++) {
      hints[i].addEventListener("click", function () {
        this.classList.add("millionaire-hints__hint_disabled");
      });
    }

    half.addEventListener("click", that.hint.half);

    // заполнить список прогресса
    progress.forEach(function (el, i) {
      let item = document.createElement("div");
      item.classList.add("millionaire-progress-list__item");
      item.innerText = `${splitIt(el)}$`;

      progressList.appendChild(item);
    });

    this.setStep();

    // обработчик для ответов
    answers.addEventListener("click", function (e) {
      let picked = event.target.closest(
        ".millionaire-ui-answers__item:not(.millionaire-ui-answers__item_lock)"
      );
      if (!picked) return;
      that.getChoise(picked);
    });
  }
})();
